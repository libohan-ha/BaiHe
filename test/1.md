
## 1. 项目背景与目标

### 1.1 项目起源
随着ACG文化的发展，百合（Yuri）题材的爱好者群体日益壮大。然而，目前中文互联网上缺乏一个专注、纯净、易于管理的平台，供爱好者系统地收藏、分享和发现高质量的百合向同人小说与短文。本项目旨在填补这一空白，同时作为个人全栈技术能力的综合实践项目，覆盖从产品设计到部署上线的完整流程。

### 1.2 目标用户
1.  **百合文化爱好者：** 核心用户，有阅读、收藏百合文的需求，希望有一个专属的、无干扰的社区环境。
2.  **同人作者：** 次要用户，有展示和分享自己创作的需求，希望作品能被精准的读者群看到。
3.  **技术实践者（本人）：** 项目的主要开发者与维护者，核心目标是技术练手与项目闭环。

### 1.3 核心价值
- **对用户：** 提供一个**去中心化、高聚合度、易于检索**的百合文内容档案馆，降低爱好者寻找优质内容的成本。
- **对开发者：** 一个**完整、实用、可部署**的全栈项目实践，深入理解现代Web开发从技术选型到运维部署的每一个环节。

### 1.4 项目目标
1.  **技术练手目标：**
    - 实践 **React + Vite + Node.js + Express + PostgreSQL + Prisma** 的现代技术栈。
    - 实现前后端完全分离，编写清晰的RESTful API。
    - 掌握**Docker容器化**与**Docker Compose**编排，实现一键部署至云服务器。
    - 集成第三方服务（如阿里云OSS、Markdown编辑器）。
2.  **功能完整目标：**
    - 构建一个具备**核心内容浏览、搜索、创作、收藏**功能的MVP（最小可行产品）。
    - 确保用户体验流畅，界面简洁美观，移动端适配。
    - 建立可扩展的数据模型，为未来功能迭代打下基础。

---

## 2. 产品功能清单

### P0 (MVP，必须实现)
- **用户系统：**
  - 用户注册（邮箱/用户名+密码）。
  - 用户登录/登出。
  - **匿名用户**可以浏览、查看文章、使用搜索。
- **文章管理：**
  - 用户投稿功能（标题、作者/译者、摘要、正文Markdown编辑器）。
  - 文章详情页展示（渲染Markdown为HTML）。
  - 文章列表页（首页），支持分页。
  - 基础标签（Tags）系统：投稿时可选择或创建标签，按标签筛选文章。
- **搜索与筛选：**
  - 全局关键词搜索（标题、摘要、作者）。
  - 按标签筛选文章。
- **个人中心：**
  - 查看“我的投稿”列表。
  - 收藏/取消收藏文章。
  - 查看“我的收藏”列表。

### P1 (重要，提升体验)
- **用户系统增强：**
  - 用户个人资料页（昵称、简介、头像上传至阿里云OSS）。
  - 忘记密码/重置密码功能。
- **文章管理增强：**
  - 文章编辑与删除功能（仅限作者本人）。
  - 文章状态管理（草稿、已发布）。
  - 支持上传文章封面图（至阿里云OSS）。
  - 文章阅读量统计。
- **内容发现：**
  - 热门标签云展示。
  - 简单的内容推荐（如“相关文章”，基于共有标签）。
- **基础管理员功能：**
  - 管理员后台登录。
  - 管理所有文章（查看、编辑、下架）。
  - 管理标签（合并、删除无用标签）。

### P2 (后续迭代)
- **社区互动：**
  - 文章评论功能（支持楼中楼）。
  - 对文章/评论点赞。
- **高级功能：**
  - 文章系列（连载）功能。
  - 订阅作者/标签。
  - 私信系统（基础）。
  - 更高级的搜索（全文检索，如使用PostgreSQL的`pg_search`或Elasticsearch）。
  - RSS订阅输出。
- **系统功能：**
  - 文章举报与审核机制。
  - 更完善的权限管理系统（角色：用户、作者、版主、管理员）。

---

## 3. 核心页面与流程

### 3.1 首页（`/`）
- **布局：** 顶部导航栏（Logo、搜索框、登录/注册/用户头像入口）、主体内容区、页脚。
- **内容区：**
  - 上方：搜索框、热门标签云。
  - 中部：**文章列表卡片流**。每张卡片展示：封面图（若有）、标题、摘要、作者、标签、阅读量、发布时间。
  - 底部：分页器。
- **交互：** 点击卡片进入文章详情页，点击标签进入该标签的筛选列表页。

### 3.2 文章详情页（`/article/:id`）
- **布局：** 面包屑导航、文章主区域、侧边栏/底部操作区。
- **内容：**
  - 文章标题、作者信息（可点击链接）、发布时间、阅读量。
  - 标签列表。
  - 文章正文（由Markdown渲染成的富文本）。
- **操作：** “收藏”按钮（登录用户）、“返回列表”按钮。
- **P1扩展：** “编辑”按钮（仅作者本人可见）。

### 3.3 投稿/编辑页面（`/create`, `/edit/:id`）
- **访问控制：** 仅限登录用户。
- **表单字段：**
  - 标题（必填，文本输入）。
  - 摘要（必填，文本域）。
  - 正文（必填，集成**Markdown编辑器**，如`react-markdown-editor-lite`，支持预览）。
  - 标签（必填，可从热门标签中选择或输入新标签，支持标签创建建议）。
  - 封面图（可选，图片上传组件，直传阿里云OSS）。
  - 状态选择（P1：草稿/发布）。
- **操作：** “提交/保存”按钮，“取消”按钮。

### 3.4 搜索页（`/search?q=keyword`）
- **入口：** 导航栏搜索框提交后进入。
- **布局：** 显示搜索关键词、结果数量、筛选器（如“按相关度”、“按时间”）。
- **内容：** 与首页类似的文章列表，仅展示匹配结果。

### 3.5 用户个人中心（`/user/:id` 或 `/dashboard`）
- **布局：** 用户信息侧边栏（头像、昵称、简介）、内容标签页。
- **标签页：**
  - “我的投稿”：列表形式展示用户所有文章，提供“编辑”、“删除”入口。
  - “我的收藏”：列表形式展示收藏的文章。

### 3.6 登录/注册流程
- **页面：** 独立的登录页（`/login`）和注册页（`/signup`）。
- **流程：** 标准表单提交 -> API请求 -> 成功后跳转回原页面或首页。
- **状态管理：** 登录成功后，前端存储JWT Token，全局状态（如React Context）更新用户信息，导航栏切换为用户头像下拉菜单（含“个人中心”、“退出”选项）。

---

## 4. 非功能需求

### 4.1 性能要求
- **页面加载：** 首屏加载时间（FCP）< 2秒（在良好网络环境下）。
- **API响应：** 95%的API接口响应时间 < 300ms。
- **前端构建：** 利用Vite进行高效构建，代码分割。

### 4.2 安全性
- **用户密码：** 使用bcrypt等强哈希算法存储，加盐。
- **API防护：** 对`POST/PUT/DELETE`等写操作进行用户身份验证（JWT校验）。
- **输入校验：** 前后端均对用户输入进行验证和清理，防止XSS与SQL注入（Prisma ORM已提供一定防护）。
- **敏感内容：**
  - **P1阶段：** 依赖用户自律与管理员后台人工审核（标记、下架）。
  - **P2阶段：** 可引入基于关键词或机器学习的初步过滤，结合用户举报。
- **CORS：** 正确配置后端CORS策略，仅允许前端域名访问。

### 4.3 数据备份
- **数据库：** 配置阿里云RDS PostgreSQL的自动备份策略（如果使用RDS），或通过`crontab`定期执行`pg_dump`备份至OSS/本地。

### 4.4 移动端适配
- **策略：** 采用**响应式设计**（Responsive Web Design），使用CSS Flexbox/Grid布局，确保从手机到桌面的主流屏幕尺寸均有良好浏览体验。

---

## 5. 数据模型

主要表结构设计（使用Prisma Schema定义）：

```prisma
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  username  String   @unique
  password  String   // 哈希后的密码
  avatarUrl String?  // OSS地址
  bio       String?
  role      String   @default(“USER”) // USER, ADMIN
  articles  Article[]
  collections Collection[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Article {
  id          String   @id @default(cuid())
  title       String
  summary     String
  content     String   // Markdown原文
  coverUrl    String?  // OSS地址
  authorId    String
  author      User     @relation(fields: [authorId], references: [id])
  views       Int      @default(0)
  status      String   @default(“PUBLISHED”) // DRAFT, PUBLISHED
  tags        Tag[]    @relation(“ArticleTags”)
  collections Collection[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Tag {
  id        String    @id @default(cuid())
  name      String    @unique
  articles  Article[] @relation(“ArticleTags”)
  createdAt DateTime  @default(now())
}

model Collection {
  id        String   @id @default(cuid())
  userId    String
  articleId String
  user      User     @relation(fields: [userId], references: [id])
  article   Article  @relation(fields: [articleId], references: [id])
  createdAt DateTime @default(now())
  @@unique([userId, articleId]) // 防止重复收藏
}

// P2 功能
model Comment {
  id        String   @id @default(cuid())
  content   String
  articleId String
  userId    String
  parentId  String?  // 用于楼中楼
  article   Article  @relation(fields: [articleId], references: [id])
  user      User     @relation(fields: [userId], references: [id])
  parent    Comment? @relation(“CommentReplies”, fields: [parentId], references: [id])
  replies   Comment[] @relation(“CommentReplies”)
  createdAt DateTime @default(now())
}
```

---

## 6. 技术方案建议

### 6.1 前后端分离架构
- **前端：** React (Vite) 单页应用，部署在Nginx或直接通过Vite构建后服务于静态文件。
- **后端：** Node.js + Express，提供纯RESTful JSON API。负责业务逻辑、数据库操作、文件上传签名生成等。
- **通信：** 前端通过`axios`或`fetch`调用后端API。

### 6.2 API 接口示例（RESTful）
- `GET /api/articles` - 获取文章列表（支持分页、标签过滤、搜索）
- `GET /api/articles/:id` - 获取单篇文章详情
- `POST /api/articles` - 创建新文章（需登录）
- `PUT /api/articles/:id` - 更新文章（需登录且为作者）
- `DELETE /api/articles/:id` - 删除文章（需登录且为作者或管理员）
- `POST /api/auth/login` - 用户登录
- `POST /api/auth/signup` - 用户注册
- `POST /api/upload/signature` - 获取阿里云OSS上传凭证（用于前端直传）

### 6.3 Docker部署方案概述
1.  **三个服务：**
    - `web`: 前端静态文件，使用Nginx镜像。
    - `api`: Node.js后端应用。
    - `db`: PostgreSQL数据库。
2.  **`docker-compose.yml`** 文件定义服务、网络、卷挂载（用于持久化数据库数据）。
3.  **环境变量：** 所有敏感配置（数据库连接字符串、OSS密钥、JWT Secret）通过`.env`文件管理，并在`docker-compose.yml`中注入。
4.  **部署：** 在阿里云ECS上安装Docker & Docker Compose后，`git clone`项目代码，配置`.env`，执行`docker-compose up -d`即可一键启动所有服务。

---

前端使用ant design ui，状态管理使用zustand

网站打开有bgm 轻柔的

要有后台管理功能

后端使用postgersql